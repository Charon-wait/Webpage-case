<!DOCTYPE html>
<html>
	<head>
		<meta charset="UTF-8">
		<title>后台管理美肤靓妆</title>
		<link rel="stylesheet" href="http://cdn.bootcss.com/bootstrap/3.3.0/css/bootstrap.min.css">
		<link rel="stylesheet" type="text/css" href="css/style.css"/>
		<script src="js/jquery-3.1.0.min.js"></script>
	</head>
	<body>
		
		<nav class="navbar navbar-default navbar-fixed-top" >
			<div class="container" id="logo">
				<div class="navbar-header">
					<a href="#" class="navbar-brand" style="padding: 0;">
						<img src="img/logo.png" style="margin-top: 20px;"/>
					</a>
					<button type="button" class="navbar-toggle" data-toggle="collapse" data-target="#navShow">
						<span class="sr-only">切换导航</span>
						<span class="icon-bar"></span>
						<span class="icon-bar"></span>
						<span class="icon-bar"></span>
					</button>
				</div>
				<div class="collapse navbar-collapse" id="navBox" >
					<ul class="nav navbar-nav navbar-right">
						<li><a href="../前端页面/index.html"><span class="glyphicon glyphicon-home"></span>优品惠</a></li>
						<li class="active"><a href="index.html"><span class="glyphicon glyphicon-list"></span> 我的订单</a></li>
						<li><a href="users.html"><span class="glyphicon glyphicon-fire"></span> 用户管理</a></li>
						<li><a href="#"><span class="glyphicon glyphicon-question-sign"></span> 资金管理</a></li>
					</ul>
				</div>
			</div>
		</nav>
		
		<div id="side">
			<div class="container container-fluid">
				<div class="row">
					<div class="col-xs-2" id="tabLeft">
						<nav class="navbar navbar-default" id="navLeft">
							<div class="container-fluid">
								<ul class="nav navbar-nav" id="fenlei">
							        <li><a href="index.html">全部商品</a></li>
							        <li><a href="pzcf.html">品质厨房</a></li>
							        <li><a href="msms.html">美食民生</a></li>
							        <li><a href="jksh.html">健康生活</a></li>
							        <li><a href="mlcd.html">魅力穿戴</a></li>
							        <li><a href="zbcc.html">珠宝收藏</a></li>
							        <li class="liActive"><a href="#">美肤靓妆</a></li>
							      </ul>
							</div>
						</nav>
					</div>
					<div class="col-xs-10" style="padding-top: 10px;">
						<p class="text-success">
							<ul class="nav navbar-nav pull-left" id="erji">
								<li class="liActive"><a href="#">品牌护肤</a></li>
								<li><a href="#">洗护护理</a></li>
								<li><a href="#">彩妆香水</a></li>
								<li><a href="#">美容仪器</a></li>
							</ul>
							<button class="btn btn-primary btn-xs pull-right" id="addGood" data-toggle="modal" data-target="#myModal" style="float: right;font-size: 14px;margin: 7px 10px;">新增商品</button>
						</p>
							<div class="modal fade" id="myModal">
								<div class="modal-dialog">
									<div class="modal-content">
										<div class="modal-header">
											<button type="button" class="close" data-dismiss="modal">
												<span>&times;</span>
											</button>
											<h3 class="modal-title" style="text-align: center;">请输入你要添加的商品信息</h3>
										</div>
										<div class="modal-body">
											<div class="container-fluid">
												<form role="form">
												  	<div class="form-group col-lg-12">
												    	<label for="goodId">商品编号</label>
												    	<input type="text" class="form-control" id="goodId" placeholder="请输入要添加的商品编号">
												  	</div>
												  	<div class="form-group col-lg-12">
												    	<label for="goodName">商品名称</label>
												    	<input type="text" class="form-control" id="goodName" placeholder="请输入要添加的商品名称">
												  	</div>
												  	<div class="form-group col-lg-12">
												    	<label for="goodPic">商品图片</label>
												    	<input type="text" class="form-control" id="goodPic" placeholder="请输入要添加的商品图片">
												  	</div>
												  	<div class="form-group col-lg-12">
												    	<label for="goodIntro">商品介绍</label>
												    	<input type="text" class="form-control" id="goodIntro" placeholder="请输入要添加的商品介绍">
												  	</div>
												  	<div class="form-group col-lg-6">
												    	<label for="goodNum">商品库存</label>
												    	<input type="text" class="form-control" id="goodNum" placeholder="请输入要添加的商品库存">
												  	</div>
												  	<div class="form-group col-lg-6">
												    	<label for="goodPrice">商品价格</label>
												    	<input type="text" class="form-control" id="goodPrice" placeholder="请输入要添加的商品价格">
												  	</div>
												</form>
											</div>
										</div>
										<div class="modal-footer">
											<button class="close" data-dismiss="modal" id="queding">确定</button>
										</div>
									</div>
								</div>
							</div>
						<table class="table-striped" id="content" border="1">
							<thead>
								<th>全选&nbsp;&nbsp;<input type="checkbox" /></th>
								<th>商品编号</th>
								<th>商品名称</th>
								<th>商品图片</th>
								<th>商品介绍</th>
								<th>商品库存</th>
								<th>商品价格</th>
								<th>编辑</th>
								<th>删除</th>
							</thead>
							<tbody>
							</tbody>
						</table>
						<p class="page">
							<a id="lastPage" href="#">&lt;上一页</a>
							<a >当前页:<a id="pageNow">1</a></a>
							<a id="nextPage" href="#">下一页&gt;</a>
							<a>&nbsp;&nbsp;&nbsp;&nbsp;到第</a>
							<input type="text" id="toPageIndex" value="1">
							<a>&nbsp;&nbsp;页&nbsp;&nbsp;</a>
							<a href="#" id="submit">确认</a>
						</p>
					</div>
				</div>
			</div>
		</div>
		
		
		<script>
			$(function(){
				var nowPage=1;
				var dataJson;
				var arrDS=[];
				var arrPZ=[];
				var arrDQ=[];
				var arrYJ=[];
				var type=0;
				
				for(var i=0;i<=6;i++){
					$("#erji").children().each(function(index){
						$(this).click(function(){
							nowPage=1;
							$("#pageNow").html(nowPage);
							$("#erji").children().each(function(){
								$(this).attr("class","");
							});
							$(this).attr("class","liActive");
							type=index;
							showData(nowPage,type);
						})
					})
				}
				
				$("#queding").click(function(){
					var dataId=$("#goodId").val();
					if(dataId==""){
						alert("商品编号不能为空!");
						return;
					}
					var jsonData={
						"id":dataId,
						"name":$("#goodName").val(),
						"imgsrc":$("#goodPic").val(),
						"intro":$("#goodIntro").val(),
						"num":$("#goodNum").val(),
						"price":$("#goodPrice").val()
					};
					var dataStr=JSON.stringify(jsonData);
					$.ajax({
						type: "GET",
						url: "http://localhost:8080/product/CreateUpdateProduct_get?id="+dataId+"&datajson="+dataStr,
						success: function(data){
						    alert("添加成功!");
						    location.reload();
						},
						 error:function(){
						   	alert("添加失败!");
						}
					});
				});
				
				$("#lastPage").click(function(){
					nowPage--;
					if(nowPage<=0){
						nowPage=1;
					}else{
						$("#pageNow").html(nowPage);
						showData(nowPage,type);
					}
					return false;
				});
				$("#nextPage").click(function(){
					nowPage++;
					$("#pageNow").html(nowPage);
					showData(nowPage,type);
					return false;
				});
				$("#submit").click(function(){
					nowPage=$("#toPageIndex").val();
					if(nowPage>=1){
						$("#pageNow").html(nowPage);
						showData(nowPage,type);
					}
					return false;
				});
				
				$(".del").click(function(){
					if($("#content tbody input:checked").length==0){
						alert("请选择你要删除的内容!");
					}
					else{
						var result=confirm("确定删除？");
						if(result){
							//http://localhost:8080/product/DeleteProductById_get?id=
							$("#content tbody td input:checked").each(function(){
								var dataId=$(this).parent().next().text();
								//alert(dataId);
								$.ajax({
								    type: "GET",
								    url: "http://localhost:8080/product/DeleteProductById_get?id="+dataId,
								    success: function(data){
								    	alert("删除成功!");
								    },
								    error:function(){
								   		alert("删除失败!");
								    }
								});
							});
							location.reload();
						}
					}
					return false;
				});
				
				$("#content thead th input").click(function(){
					if($(this).prop("checked")==true){
						$("#content tbody td input").each(function(){
							$(this).prop("checked",true);
						});
					}
					else{
						$("#content tbody td input").each(function(){
							$(this).prop("checked",false);
						});
					}
				});

				ajaxUtil();
				function ajaxUtil(){
					$.ajax({
						type: "GET",
						url: "http://localhost:8080/product/GetProductsByPage_get?pagesize=200&pageindex=1",
						success: function(data){
							dataJson=JSON.parse(data);
							initArr(dataJson);
						},
						error:function(){
							alert("获取数据失败!");
						}	 
					});
				}
				
				function initArr(data){
					for(var i=0;i<data.length;i++){
						var strData=JSON.parse(data[i].Data);
						if(strData.id.substring(0,2)=="61"){
							arrDS.push(strData);
						}else if(strData.id.substring(0,2)=="62"){
							arrPZ.push(strData);
						}else if(strData.id.substring(0,2)=="63"){
							arrDQ.push(strData);
						}else if(strData.id.substring(0,2)=="64"){
							arrYJ.push(strData);
						}
					}
					showData(nowPage,type);
				}
				
				function showData(index,type){
					$("#content tbody").html("");
					if(type==0){
						if(5*(index-1)<=arrDS.length){
							for(var i=5*(index-1);i<5*index;i++){
								if(i<arrDS.length)
									appendData(arrDS[i]);
							}
						}
					}else if(type==1){
						if(5*(index-1)<=arrPZ.length){
							for(var i=5*(index-1);i<5*index;i++){
								if(i<arrPZ.length)
									appendData(arrPZ[i]);
							}
						}
					}else if(type==2){
						if(5*(index-1)<=arrDQ.length){
							for(var i=5*(index-1);i<5*index;i++){
								if(i<arrDQ.length)
									appendData(arrDQ[i]);
							}
						}
					}else if(type==3){
						if(5*(index-1)<=arrYJ.length){
							for(var i=5*(index-1);i<5*index;i++){
								if(i<arrYJ.length)
									appendData(arrYJ[i]);
							}
						}
					}
				}
				
				function appendData(strData){
					var str="<tr><td><input type=\"checkbox\" /></td>";
						str+="<td>"+strData.id+"</td><td>"+strData.name+"</td>";
						str+="<td>"+strData.imgsrc+"</td>"
						str+="<td>"+strData.intro+"</td>";
						str+="<td>"+strData.num+"</td>";
						str+="<td>"+strData.price+"</td>";
						str+="<td><a href=\"#\" class=\"glyphicon glyphicon-list-alt bianji\"></a></td>";
						str+="<td><a href=\"#\" class=\"glyphicon glyphicon-trash shanchu\"></a></td></tr>";
					$("tbody").append(str);
					del();
					bianji();
				}
				
				function bianji(){
					$(".bianji").each(function(){
								$(this).click(function(){
									var dom=$(this).parent().parent();
									var dataId=$(this).parent().parent().children().eq(1).html();
									var dataName=$(this).parent().parent().children().eq(2).html();
									var dataPic=$(this).parent().parent().children().eq(3).html();
									var dataIntro=$(this).parent().parent().children().eq(4).html();
									var dataNum=$(this).parent().parent().children().eq(5).html();
									var dataPrice=$(this).parent().parent().children().eq(6).html();
									var str="<td><input type=\"checkbox\" /></td>";
										str+="<td>"+dataId+"</td>";
										str+="<td><input type=\"text\" value=\""+dataName+"\" /></td>";
										str+="<td><input type=\"text\" value=\""+dataPic+"\" /></td>";
										str+="<td><input type=\"text\" value=\""+dataIntro+"\" /></td>";
										str+="<td><input type=\"text\" value=\""+dataNum+"\" /></td>";
										str+="<td><input type=\"text\" value=\""+dataPrice+"\" /></td>";
										str+="<td><a href=\"#\" class=\"bjqd\">确定</a></td>";
										str+="<td><a href=\"#\" class=\"glyphicon glyphicon-trash shanchu\"></a></td>";
									dom.html(str);
									$(".bjqd").click(function(){
											var jsonData={
												"id":dataId,
												"name":$(this).parent().parent().children().eq(2).children().val(),
												"imgsrc":$(this).parent().parent().children().eq(3).children().val(),
												"intro":$(this).parent().parent().children().eq(4).children().val(),
												"num":$(this).parent().parent().children().eq(5).children().val(),
												"price":$(this).parent().parent().children().eq(6).children().val()
											};
											var dataStr=JSON.stringify(jsonData);
											$.ajax({
											    type: "GET",
											    url: "http://localhost:8080/product/CreateUpdateProduct_get?id="+dataId+"&datajson="+dataStr,
											    success: function(data){
											    	var newStr="<td><input type=\"checkbox\" /></td>";
														newStr+="<td>"+jsonData.id+"</td><td>"+jsonData.name+"</td>";
														newStr+="<td>"+jsonData.imgsrc+"</td>"
														newStr+="<td>"+jsonData.intro+"</td>";
														newStr+="<td>"+jsonData.num+"</td>";
														newStr+="<td>"+jsonData.price+"</td>";
														newStr+="<td><a href=\"#\" class=\"glyphicon glyphicon-list-alt bianji\"></a></td>";
														newStr+="<td><a href=\"#\" class=\"glyphicon glyphicon-trash shanchu\"></a></td>";
											    	dom.html(newStr);
											    	bianji();
											    },
											    error:function(){
											   		alert("修改失败!");
											    }
											});
										
									})
								})
							});
				}
				
				function del(){
					$(".shanchu").each(function(){
						$(this).click(function(){
							var result=confirm("是否确定删除？");
							if(result){
								var dataId=$(this).parent().parent().children().eq(1).html();
								$.ajax({
									type: "GET",
									url: "http://localhost:8080/product/DeleteProductById_get?id="+dataId,
									success: function(data){
										alert("删除成功!");
									},
									error:function(){
									alert("删除失败!");
									}
								});
								location.reload();
							}
						})
					});
				}
			})

		</script>
		
		<script src="js/bootstrap.min.js"></script>
	</body>
</html>
